{% extends 'base.html' %}
{% block title %}Profile{% endblock %}
{% block contents %}
{% if messages %}
<div id="flash-messages" style="
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1050;
    width: 300px;">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="profile-container">
 <div class="profile-header text-center">
  <img src="{{ user.image.url }}" class="profile-avatar mb-3" alt="Profile" data-bs-toggle="modal" data-bs-target="#editProfileModal">
  <h3 class="mb-2">{{ user.first_name }} {{ user.last_name }}</h3>
  <p class="mb-3">{{ user.email }}</p>
    
    <div class="profile-stats">
      <div class="stat-item">
        <div class="stat-value">25</div>
        <div class="stat-label">Total Orders</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">20</div>
        <div class="stat-label">Completed</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">3</div>
        <div class="stat-label">Pending</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">92%</div>
        <div class="stat-label">Success Rate</div>
      </div>
    </div>
  </div>
  
  <div class="row">
    <div class="col-md-6">
      <div class="profile-card">
        <h5><i class="fas fa-user-circle me-2"></i> Personal Information</h5>
        
        <div class="info-item">
          <div class="info-icon"><i class="fas fa-user"></i></div>
          <div>
            <strong>Username:</strong> {{ user.username }}
          </div>
        </div>
        
        <div class="info-item">
          <div class="info-icon"><i class="fas fa-birthday-cake"></i></div>
          <div>
            <strong>Date of Birth:</strong> {{ user.date_Birth }}
          </div>
        </div>
        
        <div class="info-item">
          <div class="info-icon"><i class="fas fa-venus-mars"></i></div>
          <div>
            <strong>Gender:</strong> {{ user.gender }}
          </div>
        </div>
        
        <div class="info-item">
          <div class="info-icon"><i class="fas fa-phone"></i></div>
          <div>
            <strong>Phone:</strong> {{ user.phone }}
          </div>
        </div>
        
        <div class="text-center mt-3">
          <button class="btn-edit" data-bs-toggle="modal" data-bs-target="#editProfileModal">
            <i class="fas fa-edit me-2"></i>Edit Profile
          </button>
        </div>
      </div>
    </div>
    
    <!-- Order Analytics -->
    <div class="col-md-6">
      <div class="profile-card">
        <h5><i class="fas fa-shopping-bag me-2"></i> Order Analytics</h5>
        
        <div class="progress-container">
          <div class="progress-label">
            <span>Completed</span>
            <span>80%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 80%"></div>
          </div>
        </div>
        
        <div class="progress-container">
          <div class="progress-label">
            <span>Pending</span>
            <span>12%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 12%"></div>
          </div>
        </div>
        
        <div class="progress-container">
          <div class="progress-label">
            <span>Cancelled</span>
            <span>8%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 8%"></div>
          </div>
        </div>
        
        <div class="text-center mt-4">
          <a href="{% url 'orders' %}" class="btn-view-orders" >
            <i class="fas fa-list-alt me-2"></i>View All Orders
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="post" class="mt-3" enctype="multipart/form-data">
          {% csrf_token %}
          {{ form.as_p }}
          <div class="d-grid gap-2 mt-4">
            <button type="submit" class="btn-edit">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
    setTimeout(() => {
        const alerts = document.querySelectorAll('#flash-messages .alert');
        alerts.forEach(alert => {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 4000);
</script>

{% endblock %}